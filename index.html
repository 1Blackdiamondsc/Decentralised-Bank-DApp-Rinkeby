<html>
<head>

	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	 
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<!-- web3.js 1.0.0 -->    
	<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js" integrity="sha256-nWBTbvxhJgjslRyuAKJHK+XcZPlCnmIAAMixz6EefVk=" crossorigin="anonymous"></script>
  <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>

  <title>Decentralised Bank DApp</title>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css' rel='stylesheet' type='text/css'>
   <link rel="stylesheet" type="text/css" href="css/index.css">
</head>
<body class="container">
	<br>
<img src="image/haitu.png" alt="haitu">

<div class="tab"><center>
  <button class="tablinks" onclick="openTab(event, 'AboutBank')">About Bank</button>
  <button class="tablinks" onclick="openTab(event, 'MyAccount')">My Account</button>
  <button class="tablinks" onclick="openTab(event, 'Deposit')">Deposit</button>
  <button class="tablinks" onclick="openTab(event, 'Withdraw')">Withdraw</button>
  <button class="tablinks" onclick="openTab(event, 'Transfer')">Transfer</button>
</div></center>

<div id="AboutBank" class="tabcontent">
	<h3>About Bank</h3>
  <table class="table">
    <tbody>
<tr>
  <td>Bank Address:</td>
  <td><p id="BankAddress"><p></td>
</tr>
<tr>
  <td>Bank Balance:</td>
  <td><p id="BankBalance"><p></</td>
</tr> 
    </tbody>
  </table>
</div>

<div id="MyAccount" class="tabcontent">
	<h3>My Account Information</h3>
	    <table class="table">
	      <tbody>
          <tr>
            <td>My Account Address:</td>
            <td><p id="YourAccountAddress"><p></td>
          </tr>
          <tr>
            <td>My Bank Balance:</td>
            <td><p id="YourBankBalance"><p></td>
          </tr>
          <tr>
            <td>My Ether Wallet Balance:</td>
            <td><p id="YourWalletBalance"><p></td>
          </tr>
	      </tbody>
	    </table>
</div>

<div id="Deposit" class="tabcontent">
	<h3>Deposit</h3>
	    <table class="table">
	      <tbody>
          <tr>
            <td>Deposit</td>
            <td><input type="text" id="accountDeposit" maxlength="18" /></td>
          </tr>
          <tr>
            <td></td>
              <td><a href="#" onclick="deposit()" class="btn btn-primary">Deposit</a></td>
            </tr> 
            <tr>
              <td>Status:</td>
              <td><p id="DepositStatus"><p></td>
            </tr>
            <tr>
              <td>Block Number:</td>
              <td><p id="DepositBlockNumber"><p></td>
            </tr>
            <tr>
              <td>Block Hash:</td>
              <td><p id="DepositHash"><p></td>
            </tr>
	      </tbody>
	    </table>
</div>

<div id="Withdraw" class="tabcontent">
	<h3>Withdraw</h3>
	    <table class="table">
	      <tbody>
          <tr>
            <td>Withdraw</td>
            <td><input type="text" id="withdraw" maxlength="18" /></td>
          </tr>
          <tr>
            <td></td>
              <td><a href="#" onclick="withdraw()" class="btn btn-primary">Withdraw</a></td>
            </tr>
            <tr>
              <td>Status:</td>
              <td><p id="WithdrawStatus"><p></td>
            </tr>
            <tr>
              <td>Block Number:</td>
              <td><p id="WithdrawBlockNumber"><p></td>
            </tr>
            <tr>
              <td>Block Hash:</td>
              <td><p id="WithdrawHash"><p></td>
            </tr>
	      </tbody>
	    </table>
</div>

<div id="Transfer" class="tabcontent">
	<h3>Transfer</h3>
	    <table class="table">
	      <tbody>
          <tr>
            <td>Address</td>
            <td><input type="text" id="TransferAddress" maxlength="42" /></td>
          </tr>
          <tr>
            <td>Amout</td>
            <td><input type="text" id="TransferAmount" maxlength="18" /></td>
          </tr>
          <tr>
            <td></td>
              <td><a href="#" onclick="transfer()" class="btn btn-primary">Transfer</a></td>
            </tr>
            <tr>
              <td>Status:</td>
              <td><p id="TransferStatus"><p></td>
            </tr>
            <tr>
              <td>Block Number:</td>
              <td><p id="TransferBlockNumber"><p></td>
            </tr>
            <tr>
              <td>Block Hash:</td>
              <td><p id="TransferHash"><p></td>
            </tr>
	      </tbody>
	    </table>
</div>

<br>
<center>
  <b><i>Contract Address:</b> <p id="contractAddressDisplay"><p></i>
  <b><i>Deployed on:</b> Rinkeby</i>
</center>

<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.js"></script>

<script>

  function openTab(evt, tabname) {
      // Declare all variables
      var i, tabcontent, tablinks;
  
      // Get all elements with class="tabcontent" and hide them
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
      }
  
      // Get all elements with class="tablinks" and remove the class "active"
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
  
      // Show the current tab, and add an "active" class to the button that opened the tab
      document.getElementById(tabname).style.display = "block";
      evt.currentTarget.className += " active";
  }
  
  if (typeof web3 !== "undefined") {
    web3 = new Web3(web3.currentProvider);
  } else {
    web3 = new Web3(new Web3.providers.HttpProvider("Replace with your Rinkeby RPC (Infura.io)"));
  }

  var abi =[
        {
          "constant": false,
          "inputs": [],
          "name": "deposit",
          "outputs": [],
          "payable": true,
          "stateMutability": "payable",
          "type": "function"
        },
        {
          "constant": false,
          "inputs": [
            {
              "name": "receiver",
              "type": "address"
            },
            {
              "name": "amount",
              "type": "uint256"
            }
          ],
          "name": "transfer",
          "outputs": [],
          "payable": true,
          "stateMutability": "payable",
          "type": "function"
        },
        {
          "constant": false,
          "inputs": [
            {
              "name": "amount",
              "type": "uint256"
            }
          ],
          "name": "withdraw",
          "outputs": [],
          "payable": true,
          "stateMutability": "payable",
          "type": "function"
        },
        {
          "inputs": [],
          "payable": false,
          "stateMutability": "nonpayable",
          "type": "constructor"
        },
        {
          "constant": true,
          "inputs": [],
          "name": "getBankBalance",
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ],
          "payable": false,
          "stateMutability": "view",
          "type": "function"
        },
        {
          "constant": true,
          "inputs": [],
          "name": "indAddress",
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ],
          "payable": false,
          "stateMutability": "view",
          "type": "function"
        },
        {
          "constant": true,
          "inputs": [],
          "name": "indBalance",
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ],
          "payable": false,
          "stateMutability": "view",
          "type": "function"
        },
        {
          "constant": true,
          "inputs": [
            {
              "name": "",
              "type": "address"
            }
          ],
          "name": "individualBalances",
          "outputs": [
            {
              "name": "",
              "type": "uint256"
            }
          ],
          "payable": false,
          "stateMutability": "view",
          "type": "function"
        },
        {
          "constant": true,
          "inputs": [],
          "name": "owner",
          "outputs": [
            {
              "name": "",
              "type": "address"
            }
          ],
          "payable": false,
          "stateMutability": "view",
          "type": "function"
        }
      ];
    
    var contractAddress = "Replace with your Contract Address";
  
    async function init() {
      MyBank = await new web3.eth.Contract(abi, contractAddress);
      var accounts = await web3.eth.getAccounts();
      console.log(accounts);
      console.log(MyBank);
      
      web3.eth.defaultAccount = accounts[0];
      document.getElementById("YourAccountAddress").innerHTML = web3.eth.defaultAccount;
      document.getElementById("YourWalletBalance").innerHTML = await web3.eth.getBalance(web3.eth.defaultAccount) + " Wei";
      document.getElementById("BankAddress").innerHTML = MyBank.options.address;
      document.getElementById("contractAddressDisplay").innerHTML = MyBank.options.address;
      document.getElementById("BankBalance").innerHTML = await web3.eth.getBalance(MyBank.options.address) + " Wei";

      MyBank.methods.individualBalances(web3.eth.defaultAccount).call().then(function(data){
        document.getElementById("YourBankBalance").innerHTML = data + " Wei";
      });
    }
    init();
  
    // Deposit 
    async function deposit() {
      var accountDeposit = document.getElementById('accountDeposit').value;
      MyBank.methods.deposit().send({from:web3.eth.defaultAccount, value: accountDeposit }).on('receipt', function(receipt) {
        console.log(receipt);
        document.getElementById("DepositHash").innerHTML = receipt.blockHash;
        document.getElementById("DepositBlockNumber").innerHTML = receipt.blockNumber;
        document.getElementById("DepositStatus").innerHTML = receipt.status;
      });
    }

    // Withdrawal
    async function withdraw() {
      var withdraw = document.getElementById('withdraw').value;
      MyBank.methods.withdraw(withdraw).send({from: web3.eth.defaultAccount}).on('receipt', function(receipt) {
        console.log(receipt);
        document.getElementById("WithdrawHash").innerHTML = receipt.blockHash;
        document.getElementById("WithdrawBlockNumber").innerHTML = receipt.blockNumber;
        document.getElementById("WithdrawStatus").innerHTML = receipt.status;
      });
    }

    // Transfer
    async function transfer() {
      var TransferAddress = document.getElementById('TransferAddress').value;
      var TransferAmount = document.getElementById('TransferAmount').value;

      MyBank.methods.transfer(TransferAddress, TransferAmount).send({from: web3.eth.defaultAccount}).on('receipt', function(receipt) {
        console.log(receipt);
        document.getElementById("TransferHash").innerHTML = receipt.blockHash;
        document.getElementById("TransferBlockNumber").innerHTML = receipt.blockNumber;
        document.getElementById("TransferStatus").innerHTML = receipt.status;
      });
    }
  
  function cleanPadding(bstr) {
	let len = bstr.length;
	let i = len;
	// Count amount of zeroes
	while (i >= 1) {
		if(bstr[i-1] != '0') {
			break;
		}
		i--;
	}
	return(bstr.substring(0,i));
}

  </script>
</body>
</html>
